import random
import socket

import cloudscraper
import requests

from loaders.land_parser import LandParser

# page_number = 2
# url1 = (f"https://www.cian.ru/cat.php?bbox=55.8563010218%2C36.4123966742%2C56.029898671%2C36.7255070258&deal_type=sale"
#         f"&engine_version=2&in_polygon%5B1%5D=36.4930775_55.9640775%2C36.4954808_55.9690869%2C36.4996006_55.9733256"
#         f"%2C36.5047505_55.9769863%2C36.5099003_55.981225%2C36.5164235_55.984115%2C36.5236332_55.9866197%2C36"
#         f".531873_55.9854637%2C36.5394261_55.9833443%2C36.5469792_55.9814176%2C36.5548756_55.980069%2C36.562772_55"
#         f".9785276%2C36.5689518_55.9754449%2C36.5741017_55.9717842%2C36.5802815_55.9685089%2C36.5878346_55.9663895"
#         f"%2C36.5940144_55.9631142%2C36.5981343_55.9590682%2C36.6036274_55.9548295%2C36.6101506_55.9515541%2C36"
#         f".617017_55.9486641%2C36.6242268_55.9453887%2C36.6314366_55.942306%2C36.6379597_55.939416%2C36.6455128_55"
#         f".9367187%2C36.6506627_55.933058%2C36.6496327_55.928434%2C36.6451695_55.9243879%2C36.6389897_55.9211126%2C36"
#         f".6324666_55.9182225%2C36.6252568_55.9155252%2C36.6183903_55.9126352%2C36.6122105_55.9095525%2C36.6060307_55"
#         f".9060845%2C36.5995076_55.9031944%2C36.5919545_55.9006898%2C36.5833714_55.8997264%2C36.5761616_55.9022311"
#         f"%2C36.5692952_55.9055065%2C36.562772_55.9085891%2C36.5565922_55.9116718%2C36.5500691_55.9151399%2C36"
#         f".5442326_55.9184152%2C36.5373661_55.9218832%2C36.5311863_55.9255439%2C36.5246632_55.929012%2C36.5188267_55"
#         f".9322873%2C36.5129902_55.935948%2C36.5071537_55.9392234%2C36.5002873_55.9421134%2C36.4937642_55.9453887%2C36"
#         f".4889576_55.9494348%2C36.487241_55.9542515%2C36.487241_55.9590682%2C36.488271_55.9636922%2C36.4930775_55"
#         f".9640775&land_status%5B0%5D=1&land_status%5B1%5D=2&land_status%5B2%5D=5&land_status%5B3%5D=7&maxsite=100"
#         f"&object_type%5B0%5D=3&offer_type=suburban&p={page_number}&polygon_name%5B1%5D=%D0%9E%D0%B1%D0%BB%D0%B0%D1%81"
#         f"%D1%82%D1%8C"
#         f"+%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%B0")
# page_number = 3
# url2 = (f"https://www.cian.ru/cat.php?bbox=55.8563010218%2C36.4123966742%2C56.029898671%2C36.7255070258&deal_type=sale"
#         f"&engine_version=2&in_polygon%5B1%5D=36.4930775_55.9640775%2C36.4954808_55.9690869%2C36.4996006_55.9733256"
#         f"%2C36.5047505_55.9769863%2C36.5099003_55.981225%2C36.5164235_55.984115%2C36.5236332_55.9866197%2C36"
#         f".531873_55.9854637%2C36.5394261_55.9833443%2C36.5469792_55.9814176%2C36.5548756_55.980069%2C36.562772_55"
#         f".9785276%2C36.5689518_55.9754449%2C36.5741017_55.9717842%2C36.5802815_55.9685089%2C36.5878346_55.9663895"
#         f"%2C36.5940144_55.9631142%2C36.5981343_55.9590682%2C36.6036274_55.9548295%2C36.6101506_55.9515541%2C36"
#         f".617017_55.9486641%2C36.6242268_55.9453887%2C36.6314366_55.942306%2C36.6379597_55.939416%2C36.6455128_55"
#         f".9367187%2C36.6506627_55.933058%2C36.6496327_55.928434%2C36.6451695_55.9243879%2C36.6389897_55.9211126%2C36"
#         f".6324666_55.9182225%2C36.6252568_55.9155252%2C36.6183903_55.9126352%2C36.6122105_55.9095525%2C36.6060307_55"
#         f".9060845%2C36.5995076_55.9031944%2C36.5919545_55.9006898%2C36.5833714_55.8997264%2C36.5761616_55.9022311"
#         f"%2C36.5692952_55.9055065%2C36.562772_55.9085891%2C36.5565922_55.9116718%2C36.5500691_55.9151399%2C36"
#         f".5442326_55.9184152%2C36.5373661_55.9218832%2C36.5311863_55.9255439%2C36.5246632_55.929012%2C36.5188267_55"
#         f".9322873%2C36.5129902_55.935948%2C36.5071537_55.9392234%2C36.5002873_55.9421134%2C36.4937642_55.9453887%2C36"
#         f".4889576_55.9494348%2C36.487241_55.9542515%2C36.487241_55.9590682%2C36.488271_55.9636922%2C36.4930775_55"
#         f".9640775&land_status%5B0%5D=1&land_status%5B1%5D=2&land_status%5B2%5D=5&land_status%5B3%5D=7&maxsite=100"
#         f"&object_type%5B0%5D=3&offer_type=suburban&p={page_number}&polygon_name%5B1%5D=%D0%9E%D0%B1%D0%BB%D0%B0%D1%81"
#         f"%D1%82%D1%8C"
#         f"+%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%B0")
#
# url_list = [url1, url2]

url_list = [
    "https://books.toscrape.com/catalogue/category/books/business_35/index.html",
    "https://books.toscrape.com/catalogue/category/books/poetry_23/index.html",
    "https://books.toscrape.com/catalogue/category/books/fantasy_19/index.html"
]

with open("http_proxy/valid_proxy_list.txt", "r") as proxy_file:
    proxies = proxy_file.read().split("\n")

index = 0
lp = LandParser()
while index < len(url_list):
    proxy = random.choice(proxies)
    url = url_list[index]

    try:
        print("Loading " + url + " with proxy " + proxy)
        lp.set_proxy(proxy)
        res = lp.load_page(url)
        print(res.status_code)
        index += 1
        continue
    except:
        print("Failed")


